<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spotify â€” Top Tracks & Albums</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <main class="center">
      <div class="card compact" role="main">
        <form
          method="post"
          class="search-form"
          aria-label="Search for an artist"
        >
          <label for="artist-input" class="sr-only">Artist name</label>
          <input
            id="artist-input"
            type="text"
            name="artist"
            placeholder="Search artist"
            value="{{ artist }}"
            required
            autocomplete="off"
          />
          <button class="btn" type="submit" aria-label="Search">Search</button>
        </form>

        {% if error %}
        <div class="error" role="alert">{{ error }}</div>
        {% endif %}

        <div class="results" aria-live="polite">
          {% if tracks %}
          <section class="tracks" aria-labelledby="top-tracks-heading">
            <h2 id="top-tracks-heading">Top Tracks</h2>
            <ul class="grid">
              {% for t in tracks %}
              <li class="card-item">
                {% set track_url = (t.external_urls.spotify if t.external_urls
                is defined and t.external_urls.spotify is defined else
                (t['external_urls']['spotify'] if (t.external_urls is defined
                and t.external_urls) else None)) %} {% if t.album and
                t.album.images and t.album.images[0] %} {% if track_url %}
                <a
                  class="card-link"
                  href="{{ track_url }}"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <img
                    class="art"
                    src="{{ t.album.images[0].url }}"
                    alt="{{ t.name|e }} cover"
                    loading="lazy"
                  />
                </a>
                {% else %}
                <img
                  class="art"
                  src="{{ t.album.images[0].url }}"
                  alt="{{ t.name|e }} cover"
                  loading="lazy"
                />
                {% endif %} {% endif %}
                <div class="meta">
                  {% if track_url %}
                  <a
                    class="card-link title"
                    href="{{ track_url }}"
                    target="_blank"
                    rel="noopener noreferrer"
                    >{{ loop.index }}. {{ t.name }}</a
                  >
                  {% else %}
                  <div class="title">{{ loop.index }}. {{ t.name }}</div>
                  {% endif %} {% if t.artists %}
                  <div class="muted">
                    {{ t.artists | map(attribute='name') | join(', ') }}
                  </div>
                  {% endif %}
                </div>
              </li>
              {% endfor %}
            </ul>
          </section>
          {% endif %} {% if albums %}
          <section class="albums" aria-labelledby="albums-heading">
            <h2 id="albums-heading">Albums</h2>
            <ul class="grid">
              {% for a in albums %}
              <li class="card-item">
                {% set album_url = (a.external_urls.spotify if a.external_urls
                is defined and a.external_urls.spotify is defined else
                (a['external_urls']['spotify'] if (a.external_urls is defined
                and a.external_urls) else None)) %} {% if a.images and
                a.images[0] %} {% if album_url %}
                <a
                  class="card-link"
                  href="{{ album_url }}"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <img
                    class="art"
                    src="{{ a.images[0].url }}"
                    alt="{{ a.name|e }} cover"
                    loading="lazy"
                  />
                </a>
                {% else %}
                <img
                  class="art"
                  src="{{ a.images[0].url }}"
                  alt="{{ a.name|e }} cover"
                  loading="lazy"
                />
                {% endif %} {% endif %}
                <div class="meta">
                  <div class="title">{{ a.name }}</div>
                  {% if a.release_date %}
                  <div class="muted">{{ a.release_date }}</div>
                  {% endif %}
                </div>
              </li>
              {% endfor %}
            </ul>
          </section>
          {% endif %}
        </div>
      </div>
    </main>
  </body>
</html>
